---
knit: (function(inputFile, encoding) {
    rmarkdown::render(inputFile, encoding = encoding, output_dir = "../docs/")
  })
output: html_document
institute: "University of Wisconsin-River Falls"
department: "College of Business and Economics"
short-author: "Kelly"
short-date: ''
short-institute: "UWRF"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, eval=FALSE)
pacman::p_load(tidyverse, readr, lubridate, jtools, huxtable, flextable, maps)

if(!require(devtools)) {
  install.packages("devtools")
}
if(!require(tutorial)) {
  devtools::install_github("datacamp/tutorial")
  library(tutorial)
}

tutorial::go_interactive(greedy = F, height = 600)
```


## In this case, we will analyse the impact of political party control on state level vaccination rates

This case is going to take our analysis of COVID-19 vaccination data to the next level. We will be visualizing how the vaccination rates change over time, and analyzing how region and political affiliation affect vaccination rates. The following section describes a subset of the data.

To complete this case, use the link to the RStudio Cloud Project below. Within that project, you will find an RMarkdown file named CaseXX.Rmd, where "XX" will be replaced by the current case number. Open this file and follow the directions therein. Once you have completed the case, knit the RMarkdown file to an MS Word document. Submit the knitted docx file below. 

To access the case project, you need to join the class workspace if you have not done so already: [http://tiny.cc/ECON326-WORKSPACE](http://tiny.cc/ECON326-WORKSPACE){target=_blank}.

The case is accessible via this [RStudio Cloud Project](https://rstudio.cloud/spaces/245665/content/3375489){target=_blank}.

### 1. Load and prepair the data set

A. You will need to load the several packages to complete this case, i.e.

```{r}
pacman::p_load(tidyverse, readr, lubridate, jtools, huxtable, flextable, maps)
```

B. Load the data

We need to load and join together three data sets, but for this case I have done this for you; thus, you only need to use the `load()` function to load the files in the data folder. We could use a separate load command for each file in the data folder, but I am a little too lazy to do that. Here is a quick cheat (note: I have not shown you this. Do not worry if it does not make sense).

```{r,results='hide'}
lapply(list.files(path = "data", pattern="*.Rdata",full.names=TRUE),
       load,
       .GlobalEnv)
```



### 2. Visulizing the data

A. Simple line plot

Use `ggplot` to make a simple line plot of the data in `vacs_rate`. Put `Vaccination_Rate` on the y-axis, `month` on the x-axis and set the color by `location`. Tip get rid of the legend by adding `theme(legend.position = "none")`.

```{r}
vacs_rate %>% 
  ggplot(aes(y=Vaccination_Rate,
             x=month,
             color=location)) +
  geom_line() +
  theme(legend.position = "none")
```

B. Lets make this plot better

1. We need to summarize the data for the nation. For this case, I have done this for you. Use `vacs_rate_summary` for this part.

2. plot this data using a new geometry --  `geom_ribbon()`. Start by mapping the mean of `Vaccination_Rate` to the y-axis and `month` to the x-axis. Then use `geom_line()` to draw the data. Next, use the following to add shaded region +/- one standard deviation from the mean, i.e.

```{r, eval = FALSE}
geom_ribbon(aes(
    ymin = sd_neg,
    ymax = sd_pos,
    alpha = 0.25
  ))
```

3. Use `geom_point(aes(y = max,x = month))` and `geom_point(aes(y = min,x = month))` to add point for the max and min observations. 


*Hint add the following to finish the look of the plot:*

```{r, eval = FALSE}
theme_bw() +
theme(legend.position = "none")
```


### 3. Visualize the difference between states of differing political control

A. Plot the the data by `state.control`

1. We need to summarize the data for the nation by `state.control`. For this case, I have done this for you. Use `vacs_rate_party_summary` for this part.

2. Plot the the data by mapping the `mean` to the y-axis, `month` to the x-axis and `state.control` to color.

B. Add add region to the plot

1. We need to summarize the data for the nation by `state.control` and `region`. For this case, I have done this for you. Use `vacs_rate_region_summary` for this part.

2. Plot the the data by mapping the `mean` to the y-axis, `month` to the x-axis and `state.control` to color. Then add a facet using region, i.e. `facet_wrap(~region)`.

C. Use a boxplot to compare vaccination rates vs. `state.control` over time beginning in August using the filter function, i.e. `filter(month >= as.Date("2021-08-01"))`

D. Use a boxplot to compare vaccination rates vs. `region` over time beginning in August using the filter function, i.e. `filter(month >= as.Date("2021-08-01"))`

E. Plot a heat map of vaccination rates.

1. Use the `geom_polygon()` geometry along with the `vacs_rate_map` data frame to create a heat map of vaccination rates.  
2. Use `filter(month %in% c(as.Date("2021-08-01"),as.Date("2021-11-01")))` to limit to August and November.
3. Here is an example of how to do this:

```{r}
vacs_rate_map %>% 
  filter(month %in% c(as.Date("2021-08-01"),as.Date("2021-11-01"))) %>% 
  ggplot() +
  geom_polygon( 
          aes(x=long, y=lat, group=group, fill = Vaccination_Rate), 
          color="black", size = 0.2) +
  facet_wrap(~month)
```

